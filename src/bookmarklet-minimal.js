(function(){if(window.MCanvas){MCanvas.open();return}const d=document;const container=d.createElement('div');container.id='mc-c';container.style.cssText='position:fixed;top:0;right:-900px;width:900px;height:100vh;background:white;box-shadow:-4px 0 16px rgba(0,0,0,.2);z-index:999999;transition:right .3s';const iframe=d.createElement('iframe');iframe.src='https://metadata-agent-canvas.vercel.app/?mode=bookmarklet';iframe.style.cssText='width:100%;height:100%;border:none';container.appendChild(iframe);d.body.appendChild(container);const button=d.createElement('button');button.innerHTML='üìù';button.style.cssText='position:fixed;bottom:24px;right:24px;width:56px;height:56px;border-radius:50%;background:#0062ac;color:white;border:none;font-size:24px;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.3);z-index:999998';button.onclick=function(){container.style.right=container.style.right==='0px'?'-900px':'0'};d.body.appendChild(button);const sendData=function(){if(!iframe.contentWindow){setTimeout(sendData,200);return}const getMeta=function(name){const el=d.querySelector('meta[name="'+name+'"]')||d.querySelector('meta[property="'+name+'"]');return el?el.getAttribute('content'):null};let text='Titel: '+d.title+'\n\nURL: '+window.location.href+'\n\n';const desc=getMeta('description');const author=getMeta('author');const keywords=getMeta('keywords');const ogTitle=getMeta('og:title');const ogDesc=getMeta('og:description');const ogType=getMeta('og:type');if(desc)text+='Beschreibung: '+desc+'\n\n';if(author)text+='Autor: '+author+'\n\n';if(keywords)text+='Keywords: '+keywords+'\n\n';if(ogTitle||ogDesc){text+='--- OpenGraph ---\n';if(ogTitle)text+='Title: '+ogTitle+'\n';if(ogType)text+='Type: '+ogType+'\n';if(ogDesc)text+='Description: '+ogDesc+'\n';text+='\n'}const selectors=['main','article','[role="main"]','.main-content','#content'];let mainContent='';for(let i=0;i<selectors.length;i++){const el=d.querySelector(selectors[i]);if(el){mainContent=(el.innerText||el.textContent).substring(0,5000);break}}if(!mainContent)mainContent=d.body.innerText.substring(0,5000);text+='--- Seiteninhalt ---\n'+mainContent.substring(0,2000).trim()+'\n\n';try{iframe.contentWindow.postMessage({type:'SET_PAGE_DATA',text:text,url:window.location.href,pageTitle:d.title,mode:'bookmarklet',pageData:{url:window.location.href,title:d.title,meta:{description:desc,author:author,keywords:keywords},openGraph:{title:ogTitle,description:ogDesc,type:ogType},mainContent:mainContent}},'*');console.log('Daten gesendet mit '+mainContent.length+' Zeichen Inhalt')}catch(e){console.error('Fehler:',e)}};window.MCanvas={open:function(){container.style.right='0';sendData()},close:function(){container.style.right='-900px';setTimeout(function(){container.remove();button.remove()},300)}};window.addEventListener('message',function(e){if(e.data&&e.data.type==='CANVAS_CLOSE'){console.log('Schlie√üe Sidebar');MCanvas.close()}});setTimeout(function(){container.style.right='0';setTimeout(sendData,1500)},100)})();
