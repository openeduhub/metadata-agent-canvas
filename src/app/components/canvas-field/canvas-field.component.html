<!-- Only render actual input fields, skip parent containers -->
<div class="canvas-field" [ngClass]="getStatusClass()" *ngIf="!field.isParent">
    <mat-form-field
      appearance="outline"
      floatLabel="always"
      subscriptSizing="dynamic"
      class="md3-text-field"
      [class.has-error]="hasError"
      [class.is-disabled]="field.status === FieldStatus.EXTRACTING"
    >
      <mat-label>
        {{ getFieldLabel() }}
        <span *ngIf="field.isRequired" class="required-marker">*</span>
      </mat-label>

      <div
        class="selected-pill-row"
        *ngIf="field.multiple && field.value && field.value.length > 0"
      >
        <mat-chip-set class="chip-container inline" aria-label="Selected values">
          <mat-chip *ngFor="let item of field.value" highlighted (removed)="!readonly && removeChip(item)">
            {{ getVocabularyLabel(item) }}
            <button *ngIf="!readonly" matChipRemove type="button">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
        </mat-chip-set>
      </div>

      <!-- Boolean field: mat-select -->
      <mat-select
        *ngIf="field.datatype === 'boolean'"
        [(ngModel)]="inputValue"
        (selectionChange)="onBooleanChange($event.value)"
        [disabled]="field.status === FieldStatus.EXTRACTING || readonly"
        [attr.aria-describedby]="getSupportId(field.fieldId)"
      >
        <mat-option [value]="null">{{ 'FIELD.BOOLEAN.EMPTY' | translate }}</mat-option>
        <mat-option [value]="'true'">{{ 'FIELD.BOOLEAN.TRUE' | translate }}</mat-option>
        <mat-option [value]="'false'">{{ 'FIELD.BOOLEAN.FALSE' | translate }}</mat-option>
      </mat-select>

      <!-- Date field: date input -->
      <input
        *ngIf="field.datatype === 'date'"
        matInput
        type="date"
        [(ngModel)]="inputValue"
        (input)="onInput($event)"
        (blur)="onBlur()"
        [disabled]="field.status === FieldStatus.EXTRACTING || readonly"
        [attr.aria-describedby]="getSupportId(field.fieldId)"
      />

      <!-- DateTime field: datetime-local input -->
      <input
        *ngIf="field.datatype === 'datetime'"
        matInput
        type="datetime-local"
        [(ngModel)]="inputValue"
        (input)="onInput($event)"
        (blur)="onBlur()"
        [disabled]="field.status === FieldStatus.EXTRACTING || readonly"
        [attr.aria-describedby]="getSupportId(field.fieldId)"
      />

      <!-- Time field: time input -->
      <input
        *ngIf="field.datatype === 'time'"
        matInput
        type="time"
        [(ngModel)]="inputValue"
        (input)="onInput($event)"
        (blur)="onBlur()"
        [disabled]="field.status === FieldStatus.EXTRACTING || readonly"
        [attr.aria-describedby]="getSupportId(field.fieldId)"
      />

      <!-- Regular text/number fields: textarea -->
      <textarea
        *ngIf="field.datatype !== 'boolean' && field.datatype !== 'date' && field.datatype !== 'datetime' && field.datatype !== 'time'"
        #textareaRef
        matInput
        rows="1"
        cdkTextareaAutosize
        cdkAutosizeMinRows="1"
        cdkAutosizeMaxRows="5"
        [(ngModel)]="inputValue"
        (input)="onInput($event)"
        (blur)="onBlur()"
        (focus)="onFocus(mainAutocomplete)"
        (keypress)="onKeyPress($event)"
        [disabled]="field.status === FieldStatus.EXTRACTING || readonly"
        [matAutocomplete]="auto"
        [attr.aria-describedby]="getSupportId(field.fieldId)"
        #mainAutocomplete="matAutocompleteTrigger"
      ></textarea>

      <button
        *ngIf="!readonly && field.vocabulary && field.datatype !== 'boolean' && field.datatype !== 'date' && field.datatype !== 'datetime' && field.datatype !== 'time'"
        mat-icon-button
        matSuffix
        type="button"
        class="dropdown-trigger"
        (mousedown)="onDropdownMouseDown($event)"
        (click)="toggleAutocompleteFromButton()"
        aria-label="Open options"
      >
        <mat-icon>arrow_drop_down</mat-icon>
      </button>

      <mat-icon
        matSuffix
        class="status-icon"
        [matTooltip]="getStatusTooltip(field.status)"
        [ngClass]="'status-' + field.status"
      >
        {{ getStatusIconName() }}
      </mat-icon>

      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectOption($event.option.value)">
        <mat-option *ngFor="let option of filteredOptions" [value]="option">
          {{ option }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <!-- Support text below field -->
    <div class="support-text" *ngIf="supportText && !hasError" [id]="getSupportId(field.fieldId)">
      {{ supportText }}
    </div>

    <!-- Error text below field -->
    <div class="error-text" *ngIf="hasError">
      {{ errorText }}
    </div>

    <div class="field-actions" *ngIf="hasGeoCoordinates()">
      <button
        mat-icon-button
        class="geo-button"
        [matTooltip]="'FIELD.SHOW_ON_MAP' | translate"
        (click)="openInOpenStreetMap()"
        type="button"
      >
        <mat-icon>map</mat-icon>
      </button>
    </div>
</div>
